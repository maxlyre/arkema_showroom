var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.orbitCamera.pivotPoint.add(i)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},KeyboardInput.prototype.postInitialize=function(){this.orbitCamera&&(this.startDistance=this.orbitCamera.distance,this.startYaw=this.orbitCamera.yaw,this.startPitch=this.orbitCamera.pitch,this.startPivotPosition=this.orbitCamera.pivotPoint.clone())},KeyboardInput.prototype.update=function(t){this.orbitCamera&&this.app.keyboard.wasPressed(pc.KEY_SPACE)&&(this.orbitCamera.reset(this.startYaw,this.startPitch,this.startDistance),this.orbitCamera.pivotPoint=this.startPivotPosition)};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,onWindowResize=function(){t._checkAspectRatio()};window.addEventListener("resize",onWindowResize,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var i=this.entity.getRotation();if(this._yaw=this._calcYaw(i),this._pitch=this._clampPitchAngle(this._calcPitch(i,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var e=new pc.Vec3;e.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(e.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)})),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)})),this.on("destroy",(function(){window.removeEventListener("resize",onWindowResize,!1)}))},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0,a=0,n=null,s=[],r=t.findComponents("render");for(e=0;e<r.length;++e)for(n=r[e].meshInstances,a=0;a<n.length;a++)s.push(n[a]);var h=t.findComponents("model");for(e=0;e<h.length;++e)for(n=h[e].meshInstances,a=0;a<n.length;a++)s.push(n[a]);for(e=0;e<s.length;e++)0===i?this._modelsAabb.copy(s[e].aabb):this._modelsAabb.add(s[e].aabb),i+=1;return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var n=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,n),Math.atan2(n.y,-n.z)*pc.math.RAD_TO_DEG};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,h=this.entity.camera,c=this.orbitCamera.distance;h.screenToWorld(t.x,t.y,c,i),h.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var h=this.getPinchDistance(o[0],o[1]),c=h-this.lastPinchDistance;this.lastPinchDistance=h,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}};var CustomShader=pc.createScript("customShader");CustomShader.attributes.add("vs",{type:"asset",assetType:"shader",title:"Vertex Shader"}),CustomShader.attributes.add("fs",{type:"asset",assetType:"shader",title:"Fragment Shader"}),CustomShader.attributes.add("usineColor",{type:"rgba",title:"Usine color"}),CustomShader.attributes.add("commercialColor",{type:"rgba",title:"Agence commercial color"}),CustomShader.attributes.add("rdColor",{type:"rgba",title:"R&D color"}),CustomShader.attributes.add("siegeColor",{type:"rgba",title:"Siege Social color"}),CustomShader.attributes.add("techniqueColor",{type:"rgba",title:"Centre technique color"}),CustomShader.attributes.add("usine",{type:"number",title:"Usine Number",default:.2}),CustomShader.attributes.add("commercial",{type:"number",title:"Agence commercial Number",default:.2}),CustomShader.attributes.add("rd",{type:"number",title:"R&D Number",default:.2}),CustomShader.attributes.add("siege",{type:"number",title:"Siege Social Number",default:.2}),CustomShader.attributes.add("technique",{type:"number",title:"Centre technique Number",default:.2}),CustomShader.prototype.initialize=function(){this.time=0;this.app;let e=(new pc.StandardMaterial).clone(this.entity.model.model.meshInstances[2].material);e.chunks.diffusePS=this.fs.resource,e.diffuseMap=new pc.Texture(this.app.graphicsDevice,{width:1,height:1,format:pc.PIXELFORMAT_R8_G8_B8}),e.setParameter("uUsineColor",new pc.Vec3(this.usineColor.r,this.usineColor.g,this.usineColor.b).data),e.setParameter("uCommercialColor",new pc.Vec3(this.commercialColor.r,this.commercialColor.g,this.commercialColor.b).data),e.setParameter("uRDColor",new pc.Vec3(this.rdColor.r,this.rdColor.g,this.rdColor.b).data),e.setParameter("uSiegeColor",new pc.Vec3(this.siegeColor.r,this.siegeColor.g,this.siegeColor.b).data),e.setParameter("uTechniqueColor",new pc.Vec3(this.techniqueColor.r,this.techniqueColor.g,this.techniqueColor.b).data),e.setParameter("uUsine",this.usine),e.setParameter("uCommercial",this.commercial),e.setParameter("uRD",this.rd),e.setParameter("uSiege",this.siege),e.setParameter("uTechnique",this.technique),e.update(),this.entity.model.model.meshInstances[2].material=e;let t=new pc.StandardMaterial;this.technique>0?t.diffuse.set(this.techniqueColor.r,this.techniqueColor.g,this.techniqueColor.b):this.siege>0?t.diffuse.set(this.siegeColor.r,this.siegeColor.g,this.siegeColor.b):this.rd>0?t.diffuse.set(this.rdColor.r,this.rdColor.g,this.rdColor.b):this.commercial>0?t.diffuse.set(this.commercialColor.r,this.commercialColor.g,this.commercialColor.b):t.diffuse.set(this.usineColor.r,this.usineColor.g,this.usineColor.b),t.update(),this.entity.model.model.meshInstances[0].material=t},CustomShader.prototype.update=function(e){},CustomShader.prototype.updateChiffre=function(e){};var Spawner=pc.createScript("spawner"),entityCount=150,radius=8,minScale=1.5,maxScale=3.5;Spawner.prototype.initialize=function(){this.app.fire("set:json","http://127.0.0.1/1337/uploads/arkj_6d132c6ac2.json"),console.log("test")},Spawner.prototype.update=function(t){},Spawner.prototype.spawn=function(t){for(i=0;i<t.spots.length;i++){var a=this.app.assets.get(58515737).resource.instantiate(),s=t.spots[i].lat,o=t.spots[i].long,e=(90-s)*(Math.PI/180),r=(o+180)*(Math.PI/180),c=-radius*Math.sin(e)*Math.cos(r),p=radius*Math.sin(e)*Math.sin(r),n=radius*Math.cos(e);a.setLocalPosition(c,n,p),a.lookAt(new pc.Vec3(0,0,0)),a.rotateLocal(90,0,0);var l=t.spots[i].employee.map(t.minMax[0],t.minMax[1],minScale,maxScale);a.setLocalScale(.1,l,.1),a.name="Data-"+i,a.script.customShader.usine=t.spots[i].colorData.usine,a.script.customShader.commercial=t.spots[i].colorData.commercial,a.script.customShader.rd=t.spots[i].colorData.rd,a.script.customShader.siege=t.spots[i].colorData.siege,a.script.customShader.technique=t.spots[i].colorData.technique,a.dataStore=t.spots[i].datas,a.children[1].collision.halfExtents=new pc.Vec3(.1,l,.1),this.app.root.addChild(a)}},Number.prototype.map=function(t,a,s,o){return(this-t)*(o-s)/(a-t)+s};var uiEntity,Raycast=pc.createScript("raycast");Raycast.prototype.initialize=function(){uiEntity=this.app.root.findByName("ui"),this.entity.camera?(this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.mouseDown,this),this.app.touch&&this.app.touch.on(pc.EVENT_TOUCHSTART,this.touchStart,this)):console.error("This script must be applied to an entity with a camera component.")},Raycast.prototype.mouseDown=function(t){this.doRaycast(t.x,t.y)},Raycast.prototype.touchStart=function(t){1===t.touches.length&&this.doRaycast(t.touches[0].x,t.touches[0].y),t.event.preventDefault()},Raycast.prototype.doRaycast=function(t,i){let a=this.entity.getPosition(),e=this.entity.camera.screenToWorld(t,i,this.entity.camera.farClip),o=this.app.systems.rigidbody.raycastFirst(a,e);if(o){let t=o.entity;"earth"!=t.name&&uiEntity.script.ui.select(t.parent.dataStore)}};var orbit,Ui=pc.createScript("ui");Ui.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Ui.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"});var leftMove=!1,rightMove=!1,topMove=!1,bottomMove=!1,autoRotate=!0,autoRotateTimeout=null,speed=20;Ui.prototype.initialize=function(){var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"),this.div.innerHTML=this.html.resource||"",pc.app.graphicsDevice.canvas.parentNode.appendChild(this.div),this.div.addEventListener("mousedown",(function(t){t.stopPropagation()})),this.initEventListener(),orbit=this.app.root.findByName("Camera").script.orbitCamera},Ui.prototype.select=function(t){var e=document.querySelector("#textrow"),o=document.querySelector(".text");o.innerHTML="";for(let i=0;i<t.length;i++){var n=document.importNode(e.content,!0);n.querySelector(".name").textContent=t[i].name,n.querySelector(".country").textContent=t[i].country,n.querySelector(".city").textContent=t[i].city,n.querySelector(".type").textContent=t[i].site,n.querySelector(".employee").textContent=t[i].employee,o.appendChild(n)}},Ui.prototype.initEventListener=function(){document.querySelector(".scroll_top").addEventListener("mousedown",(function(t){var e=document.querySelector(".text");e.scrollTo({top:e.scrollTop-200,behavior:"smooth"}),t.stopPropagation()})),document.querySelector(".scroll_bottom").addEventListener("mousedown",(function(t){var e=document.querySelector(".text");e.scrollTo({top:e.scrollTop+200,behavior:"smooth"}),t.stopPropagation()})),document.querySelector(".cam_left").addEventListener("mousedown",(function(t){leftMove=!0,autoRotate=!1,clearTimeout(autoRotateTimeout),t.stopPropagation()})),document.querySelector(".cam_right").addEventListener("mousedown",(function(t){rightMove=!0,autoRotate=!1,clearTimeout(autoRotateTimeout),t.stopPropagation()})),document.querySelector(".cam_top").addEventListener("mousedown",(function(t){topMove=!0,autoRotate=!1,clearTimeout(autoRotateTimeout),t.stopPropagation()})),document.querySelector(".cam_bottom").addEventListener("mousedown",(function(t){bottomMove=!0,autoRotate=!1,clearTimeout(autoRotateTimeout),t.stopPropagation()})),document.querySelector("body").addEventListener("mouseup",(function(t){leftMove=!1,rightMove=!1,topMove=!1,bottomMove=!1,autoRotateTimeout=setTimeout((function(){autoRotate=!0}),3e3)}))},Ui.prototype.update=function(t){leftMove?orbit.yaw-=t*speed:rightMove?orbit.yaw+=t*speed:topMove?orbit.pitch-=t*speed:bottomMove?orbit.pitch+=t*speed:autoRotate&&(orbit.yaw+=t)};var DataStore=pc.createScript("dataStore");var data={country:"",city:"",type:"",employee:0};DataStore.prototype.initialize=function(t){new pc.Color(Math.random(),Math.random(),Math.random(),1);var a=new pc.BasicMaterial;a.color.set(Math.random(),Math.random(),Math.random()),a.update(),this.entity.model.model.meshInstances[0].material=a},DataStore.prototype.getData=function(){return data},DataStore.prototype.update=function(t){};var jsonReader=pc.createScript("csvReader");var jsonData={},spotData={minMax:[],spots:[]};jsonReader.attributes.add("jsonFile",{type:"asset",assetType:"json"}),jsonReader.attributes.add("distanceMerge",{type:"number",default:1}),jsonReader.attributes.add("distanceOffset",{type:"number",default:1}),jsonReader.attributes.add("offset",{type:"number",default:1}),jsonReader.attributes.add("autoplay",{type:"boolean",default:!1}),jsonReader.prototype.initialize=function(){this.autoplay&&this.start(),this.app.on("set:json",(function(t){this.jsonFile.resource=t,this.start()}),this)},jsonReader.prototype.start=function(){jsonData=this.jsonFile.resource,this.mergeClose(jsonData),this.findAverage(),this.offsetClose(),this.setColor();var t=this.minMax();spotData.minMax=[t.x,t.y],this.entity.script.spawner.spawn(spotData)},jsonReader.prototype.update=function(t){},jsonReader.prototype.mergeClose=function(t){let s=t.data.slice(0);for(;s.length>0;){let t={employee:0,datas:[]};t.datas.push(s[0]),t.employee=s[0].employee;for(let e=s.length-1;e>=0;e--)if(0!=e){new pc.Vec2(s[0].lat,s[0].long).distance(new pc.Vec2(s[e].lat,s[e].long))<this.distanceMerge&&s[0].country==s[e].country&&(t.employee+=s[e].employee,t.datas.push(s[e]),s.splice(e,1))}s.splice(0,1),spotData.spots.push(t)}},jsonReader.prototype.findAverage=function(){for(i=0;i<spotData.spots.length;i++){let t=0,s=0;for(y=0;y<spotData.spots[i].datas.length;y++)t+=spotData.spots[i].datas[y].lat,s+=spotData.spots[i].datas[y].long;t/=spotData.spots[i].datas.length,s/=spotData.spots[i].datas.length,spotData.spots[i].lat=t,spotData.spots[i].long=s}},jsonReader.prototype.offsetClose=function(){for(i=0;i<spotData.spots.length;i++)for(y=0;y<spotData.spots.length;y++)if(y!=i){var t=new pc.Vec2(spotData.spots[i].lat,spotData.spots[i].long),s=new pc.Vec2(spotData.spots[y].lat,spotData.spots[y].long),e=t.distance(s);if(e<this.distanceOffset){console.log(e);let a=t.sub(s);a.normalize(),spotData.spots[i].lat+=a.x*this.offset/2,spotData.spots[i].long+=a.y*this.offset/2,spotData.spots[y].lat-=a.x*this.offset/2,spotData.spots[y].long-=a.y*this.offset/2}}},jsonReader.prototype.setColor=function(){for(i=0;i<spotData.spots.length;i++){let t={usine:0,commercial:0,rd:0,siege:0,technique:0};for(y=0;y<spotData.spots[i].datas.length;y++){let s=spotData.spots[i].datas[y].employee/spotData.spots[i].employee;switch(spotData.spots[i].datas[y].site){case"USINE DE PRODUCTION":t.usine+=s;break;case"AGENCE COMMERCIALE":t.commercial+=s;break;case"CENTRE R&D":t.rd+=s;break;case"SIEGE SOCIAL":t.siege+=s;break;case"CENTRE TECHNIQUE":t.technique+=s}}spotData.spots[i].colorData=t}},jsonReader.prototype.minMax=function(){let t=new pc.Vec2(99999,0);for(i=0;i<spotData.spots.length;i++)spotData.spots[i].employee<t.x&&(t.x=spotData.spots[i].employee),spotData.spots[i].employee>t.y&&(t.y=spotData.spots[i].employee);return t},jsonReader.prototype.getData=()=>jsonData;pc.script.createLoadingScreen((function(c){}));